/* Copyright 2019, more info: https://pat.sh/projects/js-console/ */
!function(){var Q=!!~navigator.userAgent.indexOf(" AppleWebKit/"),e="js-console-",U=e+"cursor",$=e+"typer",_=e+"focus",ee=e+"nofocus",ne=e+"prompt-box",te=e+"message",oe=te+"-value",re=te+"-error";window.makeConsole=function(e,d){var o={37:W,39:D,38:M,40:I,8:function(){B(-1)&&(j(),G())},46:k,35:Y,36:X,13:function(){var e=v;if("function"==typeof d.commandValidate){var n=d.commandValidate(e);1==n||0==n?n&&S():V(n,re)}else S()},18:function(){},9:function(){"function"==typeof d.completeHandle?function(){if("function"==typeof d.completeHandle){var e=d.completeHandle(v),n=e.length;if(1===n)T.promptText(q(v,e[0]));else if(1<n&&d.cols){for(var t=v,o=0,r=0;r<n;r++)o=Math.max(o,e[r].length);o+=2;var a=Math.floor(d.cols/o),i="",s=0;for(r=0;r<n;r++){var c=e[r];i+=e[r];for(var l=c.length;l<o;l++)i+=" ";++s>=a&&(i+="\n",s=0)}V(i,oe),T.promptText(t)}}}():"function"==typeof d.completeIssuer&&d.completeIssuer(v)}},t={65:X,69:Y,68:k,78:I,80:M,66:W,70:D,75:function(){for(;j();)G()},76:K,85:function(){T.promptText("")}};d.ctrlCodes&&Object.assign(t,d.ctrlCodes);var r={70:function(){for(;m<v.length&&!Z(v[m])&&D(););for(;m<v.length&&Z(v[m])&&D(););},66:function(){for(;0<=m-1&&!Z(v[m-1])&&W(););for(;0<=m-1&&Z(v[m-1])&&W(););},68:function(){for(;m<v.length&&!Z(v[m]);)j(),G();for(;m<v.length&&Z(v[m]);)j(),G()}},a={13:function(){var e="\n"+v.split("\n").slice(-1)[0].match(/^(\s*)/g)[0];v+=e,B(e.length),G()}},i='<span class="'+U+'">&nbsp;</span>',l=e,u=document.createElement("div");u.className="js-console-inner";var s,c,f=document.createElement("textarea");f.className=$,["autocomplete","autocorrect","autocapitalize","spellcheck"].forEach(function(e){f.setAttribute(e,"off")}),f.className=$;var p=d&&d.continuedPromptLabel?d.continuedPromptLabel:"> ",m=0,v="",g="",h="",n=void 0===d.fadeOnReset||d.fadeOnReset,L=[],b=0,y=0,C=!0,T={};function E(e,n,t,o){var r=function(){console.log("endanim"),o||e.removeEventListener("animationend",r),t()};e.addEventListener("animationend",r),e.classList.add(n)}T.promptLabel=d&&d.promptLabel?d.promptLabel:"> ",l.append(u),u.append(f),f.classList.add($),d.welcomeMessage&&R(d.welcomeMessage,"js-console-welcome"),A(),d.autofocus&&(u.classList.add(_),f.focus(),setTimeout(function(){u.classList.add(_),f.focus()},100)),T.inner=u,T.typer=f,T.scrollToBottom=P,T.report=z,T.showCompletion=F,T.clearScreen=K,T.disableInput=N,T.enableInput=O,T.reset=function(){var o=void 0!==d.welcomeMessage,e=function(){for(var e=Array.from(u.children),n=0;n<e.length;++n){var t=e[n];"DIV"==t.tagName&&(o?o=!1:t.parentElement.removeChild(t))}};n?E(u.parentElement,"fadeout",function(){e(),A(),u.parentElement.classList.remove("fadeout"),u.parentElement.classList.add("fadein")}):(e(),A(),w())};var x,w=function(){u.classList.add(_),f.focus()};function A(){v="",b=m=0,O(),(s=document.createElement("div")).classList.add(ne);var e=document.createElement("span");e.classList.add("js-console-prompt-label");var n=T.continuedPrompt?p:T.promptLabel;e.innerText=n,s.append(e),e.innerHTML=e.innerHTML.replace(" ","&nbsp;"),(c=document.createElement("span")).classList.add("js-console-prompt"),s.append(c),u.append(s),G()}function H(e){if(0!=L.length){(b+=e)<0?b=L.length:b>L.length&&(b=0);v=0==b?g:L[b-1],d.historyPreserveColumn?v.length<m+1?m=v.length:0==m&&(m=v.length):m=v.length,G()}}function M(){H(-1)}function I(){H(1)}function j(){return m<v.length&&(v=v.substring(0,m)+v.substring(m+1),g=v,!0)}function k(){j()&&G()}function K(){for(var e=[],n=0;n<u.children.length;++n)(u.children[n].classList.contains(ne)||u.children[n].classList.contains(te))&&e.push(u.children[n]);for(n=0;n<e.length-1;++n)u.removeChild(e[n]);T.report(" "),T.focus()}function P(){u.setAttribute("scrollTop",u.getAttribute("scrollHeight"))}function S(){if("function"==typeof d.commandHandle){N(),t=v,L.push(t),g="";var e=v;T.continuedPrompt?h?h+="\n"+v:h=v:h=void 0,h&&(e=h);var n=d.commandHandle(e,function(e){V(e)});T.continuedPrompt&&!h&&(h=v),"boolean"==typeof n?n?V():V("Command failed.",re):"string"==typeof n?V(n,"js-console-message-success"):"object"==typeof n&&n.length?V(n):T.continuedPrompt&&V()}var t}function N(){C=!1}function O(){C=!0}function V(e,n){if(m=-1,G(),"string"==typeof e)R(e,n);else if(Array.isArray(e))for(var t in e){var o=e[t];R(o.msg,o.className)}else void 0!==e&&u.append(e);A()}function z(e,n){var t=v;s.remove(),V(e,n),T.promptText(t)}function R(e,n){var t,o,r=document.createElement("div");r.classList.add(te),n&&r.classList.add(n),o=e,(t=r).innerText=o,t.innerHTML=t.innerHTML.replace(/\t/g,"&nbsp;&nbsp;").replace(/\n/g,"<br/>"),r.classList.add("hide"),u.append(r),r.classList.remove("hide")}function B(e){return 0<=m+e&&m+e<=v.length&&(m+=e,!0)}function D(){return!!B(1)&&(G(),!0)}function W(){return!!B(-1)&&(G(),!0)}function X(){B(-m)&&G()}function Y(){B(v.length-m)&&G()}function Z(e){if("string"!=typeof e)return!1;var n=e.charCodeAt();return n>="A".charCodeAt()&&n<="Z".charCodeAt()||n>="a".charCodeAt()&&n<="z".charCodeAt()||n>="0".charCodeAt()&&n<="9".charCodeAt()}function q(e,n){if(d.autocompleteSmart){if(d.autocompleteSmart){var t=e.split(" ");""==t[t.length-1]?T.promptText(e+n):T.promptText(t.slice(0,t.length-1).join(" ")+" "+n)}}else T.promptText(e+n)}function F(e,n){var t=n.length;if(1===t)T.promptText(q(e,n[0]));else if(1<t&&d.cols){for(var o=e,r=0,a=0;a<t;a++)r=Math.max(r,n[a].length);r+=2;var i=Math.floor(d.cols/r),s="",c=0;for(a=0;a<t;a++){var l=n[a];s+=n[a];for(var u=l.length;u<r;u++)s+=" ";++c>=i&&(s+="\n",c=0)}V(s,oe),T.promptText(o)}}function G(){var e=v,n="";if(0<m&&""==e)n=i;else if(m==v.length)n=J(e)+i;else{var t=e.substring(0,m),o=e.substring(m,m+1);o&&(o='<span class="'+U+'">'+J(o)+"</span>");var r=e.substring(m+1);n=J(t)+o+J(r)}c.innerHTML=n,P()}function J(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/</g,"&lt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />")}return T.focus=function(){w()},T.notice=function(e,n){var t=document.createElement("div");t.classList.add("notice");var o=document.createElement("div");o.innerText=e,t.appendChild(o),t.classList.add("invisible"),l.append(t);var r=!0;if("fadeout"==n)setTimeout(function(){E(t,"fadeout",function(){t.parentElement.removeChild(t)})},4e3);else if("prompt"==n){var a=document.createElement("br"),i=document.createElement("div");i.classList.add("action");var s=document.createElement("a");s.setAttribute("href","javascript:"),s.innerText="OK";var c=document.createElement("div");c.classList.add("clear"),i.appendChild(s),i.appendChild(c),t.append(a),t.append(i),r=!1,a.addEventListener("click",function(){console.log("woo"),t.parentElement.removeChild(t),u.classList.remove("halfvisible")})}return t.classList.remove("invisible"),E(t,"uncovertop",function(){console.log("finished uncovering"),r||u.classList.add("halfvisible"),u.classList.remove("uncovertop")}),t.classList.add("defaultcursor"),t},x=l,d.globalCapture&&(x=document),x.addEventListener("click",function(){return window.getSelection().toString()||(u.classList.add(_),u.classList.remove(ee),Q?(e=f,n=window.scrollX,t=window.scrollY,e.focus(),window.scrollTo(n,t)):(f.classList.add("fixposition"),f.focus()),P()),!1;var e,n,t}),f.addEventListener("blur",function(){u.classList.remove(_),u.classList.add(ee)}),f.onpaste=function(e){f.value="",setTimeout(function(){f.consoleInsert(f.value),f.value=""},0)},f.onkeydown=function(e){y=0;var n=e.keyCode;if(e.ctrlKey&&67==n)return y=n,"function"==typeof d.cancelHandle&&d.cancelHandle(),!1;if(C){if(e.shiftKey&&n in a)return a[y=n](),!1;if(e.altKey&&n in r)return r[y=n](),!1;if(e.ctrlKey&&n in t)return t[y=n](),!1;if(n in o)return o[y=n](),!1}},f.onkeypress=function(e){var n,t=e.keyCode||e.which;if(((n=e).keyCode==o.tab||192==n.keyCode)&&n.altKey)return!1;if((e.ctrlKey||e.metaKey)&&"v"==String.fromCharCode(t).toLowerCase())return!0;if(C&&y!=t&&32<=t){if(y)return!1;(void 0===d.charInsertTrigger||"function"==typeof d.charInsertTrigger&&d.charInsertTrigger(t,v))&&f.consoleInsert(t)}return!Q&&void 0},f.consoleInsert=function(e){var n="number"==typeof e?String.fromCharCode(e):e;v=v.substring(0,m)+n+v.substring(m),B(n.length),g=v,G()},T.promptText=function(e){return"string"==typeof e&&(m=(v=e).length,G()),v},T}}();
