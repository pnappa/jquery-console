/* Copyright 2019, more info: https://pat.sh/projects/js-console/ */
!function(){var Q=!!~navigator.userAgent.indexOf(" AppleWebKit/"),e="jquery-console-",U=e+"cursor",X=e+"typer",Y=e+"focus",$=e+"nofocus",_=e+"prompt-box",ee=e+"message",te=ee+"-value",ne=ee+"-error";window.makeConsole=function(e,f){var o={37:R,39:z,38:M,40:j,8:function(){V(-1)&&(k(),G())},46:I,35:B,36:W,13:function(){var e=v;if("function"==typeof f.commandValidate){var t=f.commandValidate(e);1==t||0==t?t&&P():q(t,ne)}else P()},18:function(){},9:function(){"function"==typeof f.completeHandle?function(){if("function"==typeof f.completeHandle){var e=f.completeHandle(v),t=e.length;if(1===t)T.promptText(Z(v,e[0]));else if(1<t&&f.cols){for(var n=v,o=0,r=0;r<t;r++)o=Math.max(o,e[r].length);o+=2;var a=Math.floor(f.cols/o),i="",c=0;for(r=0;r<t;r++){var s=e[r];i+=e[r];for(var l=s.length;l<o;l++)i+=" ";++c>=a&&(i+="\n",c=0)}q(i,te),T.promptText(n)}}}():"function"==typeof f.completeIssuer&&f.completeIssuer(v)}},n={65:W,69:B,68:I,78:j,80:M,66:R,70:z,75:function(){for(;k();)G()},76:K,85:function(){T.promptText("")}};f.ctrlCodes&&Object.assign(n,f.ctrlCodes);var r={70:function(){for(;m<v.length&&!D(v[m])&&z(););for(;m<v.length&&D(v[m])&&z(););},66:function(){for(;0<=m-1&&!D(v[m-1])&&R(););for(;0<=m-1&&D(v[m-1])&&R(););},68:function(){for(;m<v.length&&!D(v[m]);)k(),G();for(;m<v.length&&D(v[m]);)k(),G()}},a={13:function(){var e="\n"+v.split("\n").slice(-1)[0].match(/^(\s*)/g)[0];v+=e,V(e.length),G()}},i='<span class="'+U+'">&nbsp;</span>',l=e,u=document.createElement("div");u.className="jquery-console-inner";var c,s,d=document.createElement("textarea");d.className=X,["autocomplete","autocorrect","autocapitalize","spellcheck"].forEach(function(e){d.setAttribute(e,"off")}),d.className=X;var p=f&&f.continuedPromptLabel?f.continuedPromptLabel:"> ",m=0,v="",g="",h="",t=void 0===f.fadeOnReset||f.fadeOnReset,L=[],b=0,y=0,C=!0,T={};function E(e,t,n,o){var r=function(){console.log("endanim"),o||e.removeEventListener("animationend",r),n()};e.addEventListener("animationend",r),e.classList.add(t)}T.promptLabel=f&&f.promptLabel?f.promptLabel:"> ",l.append(u),u.append(d),d.classList.add(X),f.welcomeMessage&&O(f.welcomeMessage,"jquery-console-welcome"),w(),f.autofocus&&(u.classList.add(Y),d.focus(),setTimeout(function(){u.classList.add(Y),d.focus()},100)),T.inner=u,T.typer=d,T.scrollToBottom=S,T.report=N,T.showCompletion=F,T.clearScreen=K,T.reset=function(){var o=void 0!==f.welcomeMessage,e=function(){for(var e=Array.from(u.children),t=0;t<e.length;++t){var n=e[t];"DIV"==n.tagName&&(o?o=!1:n.parentElement.removeChild(n))}};t?E(u.parentElement,"fadeout",function(){e(),w(),u.parentElement.classList.remove("fadeout"),u.parentElement.classList.add("fadein")}):(e(),w(),A())};var x,A=function(){u.classList.add(Y),d.focus()};function w(){v="",C=!(b=m=0),(c=document.createElement("div")).classList.add(_);var e=document.createElement("span");e.classList.add("jquery-console-prompt-label");var t=T.continuedPrompt?p:T.promptLabel;e.innerText=t,c.append(e),e.innerHTML=e.innerHTML.replace(" ","&nbsp;"),(s=document.createElement("span")).classList.add("jquery-console-prompt"),c.append(s),u.append(c),G()}function H(e){if(0!=L.length){(b+=e)<0?b=L.length:b>L.length&&(b=0);v=0==b?g:L[b-1],f.historyPreserveColumn?v.length<m+1?m=v.length:0==m&&(m=v.length):m=v.length,G()}}function M(){H(-1)}function j(){H(1)}function k(){return m<v.length&&(v=v.substring(0,m)+v.substring(m+1),g=v,!0)}function I(){k()&&G()}function K(){for(var e=[],t=0;t<u.children.length;++t)(u.children[t].classList.contains(_)||u.children[t].classList.contains(ee))&&e.push(u.children[t]);for(t=0;t<e.length-1;++t)u.removeChild(e[t]);T.report(" "),T.focus()}function S(){u.setAttribute("scrollTop",u.getAttribute("scrollHeight"))}function P(){if("function"==typeof f.commandHandle){C=!1,n=v,L.push(n),g="";var e=v;T.continuedPrompt?h?h+="\n"+v:h=v:h=void 0,h&&(e=h);var t=f.commandHandle(e,function(e){q(e)});T.continuedPrompt&&!h&&(h=v),"boolean"==typeof t?t?q():q("Command failed.",ne):"string"==typeof t?q(t,"jquery-console-message-success"):"object"==typeof t&&t.length?q(t):T.continuedPrompt&&q()}var n}function q(e,t){if(m=-1,G(),"string"==typeof e)O(e,t);else if(Array.isArray(e))for(var n in e){var o=e[n];O(o.msg,o.className)}else void 0!==e&&u.append(e);w()}function N(e,t){var n=v;c.remove(),q(e,t),T.promptText(n)}function O(e,t){var n,o,r=document.createElement("div");r.classList.add(ee),t&&r.classList.add(t),o=e,(n=r).innerText=o,n.innerHTML=n.innerHTML.replace(/\t/g,"&nbsp;&nbsp;").replace(/\n/g,"<br/>"),r.classList.add("hide"),u.append(r),r.classList.remove("hide")}function V(e){return 0<=m+e&&m+e<=v.length&&(m+=e,!0)}function z(){return!!V(1)&&(G(),!0)}function R(){return!!V(-1)&&(G(),!0)}function W(){V(-m)&&G()}function B(){V(v.length-m)&&G()}function D(e){if("string"!=typeof e)return!1;var t=e.charCodeAt();return t>="A".charCodeAt()&&t<="Z".charCodeAt()||t>="a".charCodeAt()&&t<="z".charCodeAt()||t>="0".charCodeAt()&&t<="9".charCodeAt()}function Z(e,t){if(f.autocompleteSmart){if(f.autocompleteSmart){var n=e.split(" ");""==n[n.length-1]?T.promptText(e+t):T.promptText(n.slice(0,n.length-1).join(" ")+" "+t)}}else T.promptText(e+t)}function F(e,t){var n=t.length;if(1===n)T.promptText(Z(e,t[0]));else if(1<n&&f.cols){for(var o=e,r=0,a=0;a<n;a++)r=Math.max(r,t[a].length);r+=2;var i=Math.floor(f.cols/r),c="",s=0;for(a=0;a<n;a++){var l=t[a];c+=t[a];for(var u=l.length;u<r;u++)c+=" ";++s>=i&&(c+="\n",s=0)}q(c,te),T.promptText(o)}}function G(){var e=v,t="";if(0<m&&""==e)t=i;else if(m==v.length)t=J(e)+i;else{var n=e.substring(0,m),o=e.substring(m,m+1);o&&(o='<span class="'+U+'">'+J(o)+"</span>");var r=e.substring(m+1);t=J(n)+o+J(r)}s.innerHTML=t,S()}function J(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/</g,"&lt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />")}return T.focus=function(){A()},T.notice=function(e,t){var n=document.createElement("div");n.classList.add("notice");var o=document.createElement("div");o.innerText=e,n.appendChild(o),n.classList.add("invisible"),l.append(n);var r=!0;if("fadeout"==t)setTimeout(function(){E(n,"fadeout",function(){n.parentElement.removeChild(n)})},4e3);else if("prompt"==t){var a=document.createElement("br"),i=document.createElement("div");i.classList.add("action");var c=document.createElement("a");c.setAttribute("href","javascript:"),c.innerText="OK";var s=document.createElement("div");s.classList.add("clear"),i.appendChild(c),i.appendChild(s),n.append(a),n.append(i),r=!1,a.addEventListener("click",function(){console.log("woo"),n.parentElement.removeChild(n),u.classList.remove("halfvisible")})}return n.classList.remove("invisible"),E(n,"uncovertop",function(){console.log("finished uncovering"),r||u.classList.add("halfvisible"),u.classList.remove("uncovertop")}),n.classList.add("defaultcursor"),n},x=l,f.globalCapture&&(x=document),x.addEventListener("click",function(){return window.getSelection().toString()||(u.classList.add(Y),u.classList.remove($),Q?focusWithoutScrolling(d):(d.classList.add("fixposition"),d.focus()),S()),!1}),d.addEventListener("blur",function(){u.classList.remove(Y),u.classList.add($)}),d.onpaste=function(e){d.value="",setTimeout(function(){d.consoleInsert(d.value),d.value=""},0)},d.onkeydown=function(e){y=0;var t=e.keyCode;if(e.ctrlKey&&67==t)return y=t,"function"==typeof f.cancelHandle&&f.cancelHandle(),!1;if(C){if(e.shiftKey&&t in a)return a[y=t](),!1;if(e.altKey&&t in r)return r[y=t](),!1;if(e.ctrlKey&&t in n)return n[y=t](),!1;if(t in o)return o[y=t](),!1}},d.onkeypress=function(e){var t,n=e.keyCode||e.which;if(((t=e).keyCode==o.tab||192==t.keyCode)&&t.altKey)return!1;if((e.ctrlKey||e.metaKey)&&"v"==String.fromCharCode(n).toLowerCase())return!0;if(C&&y!=n&&32<=n){if(y)return!1;(void 0===f.charInsertTrigger||"function"==typeof f.charInsertTrigger&&f.charInsertTrigger(n,v))&&d.consoleInsert(n)}return!Q&&void 0},d.consoleInsert=function(e){var t="number"==typeof e?String.fromCharCode(e):e;v=v.substring(0,m)+t+v.substring(m),V(t.length),g=v,G()},T.promptText=function(e){return"string"==typeof e&&(m=(v=e).length,G()),v},T}}();
